# Task Dist


## 服务端


服务端接口列表：

 * 注册设备
 * 任务开始
 * 任务获取
 * 任务汇报

任务数据结构设计：

 * concurrency: 最大并发数，0代表无并发限制
 * total: 任务分发(执行)数
 * status: 0未开始，1已开始，2已结束
 * success_num: 执行成功数
 * fail_num: 执行失败数
 * steps: 执行步骤
 	* url: 执行的url，空表示需要上一step的输出作为url
 	* method: 支持GET, POST, HEAD
 	* params: json参数
 	* headers: 
 	* type: 表示返回的内容的处理方式，'json'表示按json匹配正文获取指定内容向下传递，'web'表示获取原始输出向下传递， 'download'表示只请求，不向下传递
 	* pattern: 'json'方式的匹配规则
 	* matches: 暂时用不到，留作后续支持正则匹配的保留字段




## 客户端

客户端执行过程：

 1. 注册设备，需要客户端提供uuid，设备型号，token，app版本等信息
 2. 返回的设备id存储在本地
 3. 设置周期为每5分钟启动的后台服务
 4. 访问/task/query?device=[deviceId]接口检查是否有可执行任务，需满足以下条件：
 	* 任务队列中有待执行任务
 	* 当前设备没有在执行其他任务
 	* 一个设备一个任务中只能执行一次
 	* 任务正在执行设备的队列中达到了最大并发数
 5. 获取到待执行任务，客户端按照任务的steps按步骤执行，每一步执行完成后向服务端汇报结果和输出。
 6. 假如其中的步骤执行失败，则不继续往下执行；全部steps执行成功，才算任务执行成功。

客户端支持任务返回类型：

 * 原始输出
 * json
 	 
